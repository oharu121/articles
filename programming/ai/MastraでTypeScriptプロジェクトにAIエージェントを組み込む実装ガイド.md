## Mastraã§TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’çµ„ã¿è¾¼ã‚€å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ã¯ã˜ã‚ã«

ã€ŒAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è‡ªåˆ†ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ„ã¿è¾¼ã‚“ã§ã¿ãŸã„ã€ã¨æ€ã£ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

> ã€Œã©ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’é¸ã¹ã°ã„ã„ã®ï¼Ÿã€
> ã€ŒTypeScriptã§å®Ÿç”¨çš„ãªAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã£ã¦ä½œã‚Œã‚‹ã®ï¼Ÿã€
> ã€Œæœ¬ç•ªç’°å¢ƒã§å®‰å®šã—ã¦å‹•ä½œã•ã›ã‚‹ã«ã¯ï¼Ÿã€

ã“ã‚“ãªæ‚©ã¿ã‚’æŠ±ãˆã¦ã„ã‚‹é–‹ç™ºè€…ã«ãŠã™ã™ã‚ã—ãŸã„ã®ãŒ **Mastra** ã§ã™ã€‚Mastraã¯Gatsbyãƒãƒ¼ãƒ ãŒé–‹ç™ºã—ãŸTypeScriptãƒã‚¤ãƒ†ã‚£ãƒ–ã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œã®å¼·åŠ›ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€**Mastraã‚’ä½¿ã£ã¦å®Ÿéš›ã«TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’çµ„ã¿è¾¼ã‚€æ–¹æ³•**ã‚’ã€ã‚³ãƒ¼ãƒ‰ä¾‹ã¨ã¨ã‚‚ã«è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

## Mastraã¨ã¯ï¼Ÿ

Mastraã¯ã€**TypeScriptã§AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**ã§ã™ã€‚Gatsbyã®é–‹ç™ºãƒãƒ¼ãƒ ãŒæ‰‹ãŒã‘ã¦ãŠã‚Šã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®æ©Ÿèƒ½ã‚’é‡è¦–ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

| æ©Ÿèƒ½ | èª¬æ˜ | ãƒ¡ãƒªãƒƒãƒˆ |
|------|------|--------|
| **Agents** | AIãƒ¢ãƒ‡ãƒ«ã¨ãƒ„ãƒ¼ãƒ«ã‚’çµ„ã¿åˆã‚ã›ãŸè‡ªå¾‹ã‚·ã‚¹ãƒ†ãƒ  | è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã®è‡ªå‹•å®Ÿè¡Œ |
| **Workflows** | çŠ¶æ…‹ã‚’æŒã¤ãƒãƒ«ãƒã‚¹ãƒ†ãƒƒãƒ—å‡¦ç† | è¤‡é›‘ãªæ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®è‡ªå‹•åŒ– |
| **RAG** | ãƒ™ã‚¯ãƒˆãƒ«ã‚¹ãƒˆã‚¢ã¨ã®çµ±åˆ | å°‚é–€çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã®æ´»ç”¨ |
| **Observability** | OpenTelemetryãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚° | æœ¬ç•ªç’°å¢ƒã§ã®ç›£è¦–ãƒ»ãƒ‡ãƒãƒƒã‚° |

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨åˆæœŸè¨­å®š

ã¾ãšã€Mastraãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```bash
# æ–°ã—ã„Mastraãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
npm create mastra@latest my-ai-project
cd my-ai-project

# å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã§API ã‚­ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚

```env:.env
OPENAI_API_KEY=your_openai_api_key
ANTHROPIC_API_KEY=your_anthropic_api_key
```

### 3. åŸºæœ¬çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
my-ai-project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agents/          # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©
â”‚   â”œâ”€â”€ workflows/       # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
â”‚   â”œâ”€â”€ tools/          # ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«
â”‚   â””â”€â”€ index.ts        # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ mastra.config.js    # Mastraè¨­å®š
â””â”€â”€ package.json
```

## åŸºæœ¬çš„ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®Ÿè£…

### 1. ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½œæˆ

æœ€åˆã«ã€åŸºæœ¬çš„ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```typescript:src/agents/article-agent.ts
import { Agent } from '@mastra/core';
import { openai } from '@mastra/provider-openai';

// ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¨­å®š
const articleAgent = new Agent({
  name: 'ArticleAgent',
  instructions: `
    ã‚ãªãŸã¯æŠ€è¡“è¨˜äº‹ã‚’ä½œæˆã™ã‚‹å°‚é–€å®¶ã§ã™ã€‚
    ä¸ãˆã‚‰ã‚ŒãŸãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦ã€åˆå¿ƒè€…ã«ã‚‚ã‚ã‹ã‚Šã‚„ã™ã
    å®Ÿè·µçš„ãªè¨˜äº‹ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚
  `,
  model: openai('gpt-4o-mini'),
});

// ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ã£ãŸè¨˜äº‹ç”Ÿæˆ
export async function generateArticle(topic: string) {
  try {
    const result = await articleAgent.text(`
      ã€Œ${topic}ã€ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®æ§‹æˆã§æŠ€è¡“è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š
      
      1. ã¯ã˜ã‚ã«ï¼ˆå•é¡Œã®æèµ·ï¼‰
      2. åŸºæœ¬æ¦‚å¿µã®èª¬æ˜
      3. å®Ÿè£…ä¾‹ï¼ˆã‚³ãƒ¼ãƒ‰ä»˜ãï¼‰
      4. ã‚ˆãã‚ã‚‹èª²é¡Œã¨è§£æ±ºæ–¹æ³•
      5. ã¾ã¨ã‚
      
      èª­è€…ã¯ä¸­ç´šãƒ¬ãƒ™ãƒ«ã®TypeScripté–‹ç™ºè€…ã‚’æƒ³å®šã—ã¦ãã ã•ã„ã€‚
    `);
    
    return result.text;
  } catch (error) {
    console.error('è¨˜äº‹ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
}
```

### 2. ãƒ¡ãƒ¢ãƒªæ©Ÿèƒ½ä»˜ãã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

å¯¾è©±ã®å±¥æ­´ã‚’è¨˜æ†¶ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```typescript:src/agents/conversational-agent.ts
import { Agent, Memory } from '@mastra/core';
import { openai } from '@mastra/provider-openai';

// ãƒ¡ãƒ¢ãƒªè¨­å®š
const memory = new Memory({
  name: 'chat-memory',
  store: 'local' // ã¾ãŸã¯ 'redis', 'file'
});

const chatAgent = new Agent({
  name: 'ChatAssistant',
  instructions: `
    ã‚ãªãŸã¯è¦ªåˆ‡ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®ä¼šè©±å±¥æ­´ã‚’è¦šãˆã¦ã„ã¦ã€
    å‰ã®æ–‡è„ˆã‚’è€ƒæ…®ã—ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚
  `,
  model: openai('gpt-4o-mini'),
  memory,
});

export async function chatWithAgent(message: string, sessionId: string) {
  const response = await chatAgent.text(message, {
    sessionId, // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã§ãƒ¡ãƒ¢ãƒªã‚’ç®¡ç†
  });
  
  return response.text;
}

// ä½¿ç”¨ä¾‹
export async function runConversation() {
  const sessionId = 'user-123';
  
  // æœ€åˆã®è³ªå•
  const response1 = await chatWithAgent(
    'TypeScriptã§APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œã‚‹æ–¹æ³•ã‚’æ•™ãˆã¦',
    sessionId
  );
  console.log('å›ç­”1:', response1);
  
  // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—è³ªå•ï¼ˆå‰ã®æ–‡è„ˆã‚’è¦šãˆã¦ã„ã‚‹ï¼‰
  const response2 = await chatWithAgent(
    'ã•ã£ãã®æ–¹æ³•ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿ',
    sessionId
  );
  console.log('å›ç­”2:', response2);
}
```

## ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…

### 1. ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãƒ„ãƒ¼ãƒ«

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ“ä½œã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```typescript:src/tools/file-tool.ts
import { Tool } from '@mastra/core';
import { promises as fs } from 'fs';
import path from 'path';

export const fileOperationTool: Tool = {
  id: 'file-operations',
  name: 'File Operations',
  description: 'ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã€èª­ã¿å–ã‚Šã€å‰Šé™¤ã‚’è¡Œã†',
  schema: {
    type: 'object',
    properties: {
      operation: {
        type: 'string',
        enum: ['create', 'read', 'delete', 'list'],
        description: 'å®Ÿè¡Œã™ã‚‹æ“ä½œ'
      },
      filePath: {
        type: 'string',
        description: 'ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹'
      },
      content: {
        type: 'string',
        description: 'ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€å†…å®¹ï¼ˆcreateæ™‚ï¼‰'
      }
    },
    required: ['operation', 'filePath']
  },
  
  execute: async ({ operation, filePath, content }) => {
    try {
      switch (operation) {
        case 'create':
          await fs.writeFile(filePath, content || '', 'utf-8');
          return { success: true, message: `ãƒ•ã‚¡ã‚¤ãƒ« ${filePath} ã‚’ä½œæˆã—ã¾ã—ãŸ` };
          
        case 'read':
          const data = await fs.readFile(filePath, 'utf-8');
          return { success: true, content: data };
          
        case 'delete':
          await fs.unlink(filePath);
          return { success: true, message: `ãƒ•ã‚¡ã‚¤ãƒ« ${filePath} ã‚’å‰Šé™¤ã—ã¾ã—ãŸ` };
          
        case 'list':
          const dir = path.dirname(filePath);
          const files = await fs.readdir(dir);
          return { success: true, files };
          
        default:
          throw new Error(`æœªå¯¾å¿œã®æ“ä½œ: ${operation}`);
      }
    } catch (error) {
      return { 
        success: false, 
        error: error instanceof Error ? error.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼' 
      };
    }
  }
};
```

### 2. Web APIå‘¼ã³å‡ºã—ãƒ„ãƒ¼ãƒ«

å¤–éƒ¨APIã¨é€£æºã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```typescript:src/tools/api-tool.ts
import { Tool } from '@mastra/core';
import axios from 'axios';

export const apiRequestTool: Tool = {
  id: 'api-request',
  name: 'API Request',
  description: 'Web APIã¸ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹',
  schema: {
    type: 'object',
    properties: {
      method: {
        type: 'string',
        enum: ['GET', 'POST', 'PUT', 'DELETE'],
        description: 'HTTPãƒ¡ã‚½ãƒƒãƒ‰'
      },
      url: {
        type: 'string',
        description: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆå…ˆURL'
      },
      headers: {
        type: 'object',
        description: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼'
      },
      data: {
        type: 'object',
        description: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£'
      }
    },
    required: ['method', 'url']
  },
  
  execute: async ({ method, url, headers, data }) => {
    try {
      const response = await axios({
        method: method.toLowerCase(),
        url,
        headers,
        data,
        timeout: 10000 // 10ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
      });
      
      return {
        success: true,
        status: response.status,
        data: response.data,
        headers: response.headers
      };
    } catch (error) {
      if (axios.isAxiosError(error)) {
        return {
          success: false,
          error: error.message,
          status: error.response?.status,
          data: error.response?.data
        };
      }
      
      return {
        success: false,
        error: error instanceof Error ? error.message : 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'
      };
    }
  }
};
```

### 3. ãƒ„ãƒ¼ãƒ«ä»˜ãã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½¿ç”¨

ä½œæˆã—ãŸãƒ„ãƒ¼ãƒ«ã‚’ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«çµ„ã¿è¾¼ã¿ã¾ã™ã€‚

```typescript:src/agents/tool-agent.ts
import { Agent } from '@mastra/core';
import { openai } from '@mastra/provider-openai';
import { fileOperationTool } from '../tools/file-tool';
import { apiRequestTool } from '../tools/api-tool';

const toolAgent = new Agent({
  name: 'ToolAgent',
  instructions: `
    ã‚ãªãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨APIå‘¼ã³å‡ºã—ãŒã§ãã‚‹ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã¦é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
  `,
  model: openai('gpt-4o-mini'),
  tools: [fileOperationTool, apiRequestTool]
});

// ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®ä¾‹
export async function manageFiles() {
  const result = await toolAgent.text(`
    ä»¥ä¸‹ã®ä½œæ¥­ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
    1. 'output' ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« 'sample.txt' ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    2. ãƒ•ã‚¡ã‚¤ãƒ«ã« "Hello, Mastra!" ã¨ã„ã†å†…å®¹ã‚’æ›¸ãè¾¼ã¿
    3. ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ç¢ºèª
  `);
  
  return result.text;
}

// APIå‘¼ã³å‡ºã—ã®ä¾‹
export async function fetchExternalData() {
  const result = await toolAgent.text(`
    JSONPlaceholderã®APIã‚’ä½¿ã£ã¦ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
    1. https://jsonplaceholder.typicode.com/posts/1 ã‹ã‚‰æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    2. å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å†…å®¹ã‚’è¦ç´„
  `);
  
  return result.text;
}
```

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…

### 1. åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

è¤‡æ•°ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’çµ„ã¿åˆã‚ã›ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```typescript:src/workflows/content-workflow.ts
import { Workflow, Step } from '@mastra/core';
import { openai } from '@mastra/provider-openai';

// ãƒªã‚µãƒ¼ãƒã‚¹ãƒ†ãƒƒãƒ—
const researchStep: Step = {
  id: 'research',
  action: async ({ topic }) => {
    const agent = new Agent({
      name: 'Researcher',
      instructions: 'æŒ‡å®šã•ã‚ŒãŸãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦è©³ç´°ãªèª¿æŸ»ã‚’è¡Œã„ã€é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚',
      model: openai('gpt-4o-mini'),
    });
    
    const result = await agent.text(`ã€Œ${topic}ã€ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰èª¿æŸ»ã—ã¦ãã ã•ã„ï¼š
    1. åŸºæœ¬æ¦‚å¿µã¨å®šç¾©
    2. ä¸»è¦ãªç‰¹å¾´ã‚„åˆ©ç‚¹
    3. å®Ÿéš›ã®ä½¿ç”¨ä¾‹
    4. æ³¨æ„ã™ã¹ãç‚¹ã‚„ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
    `);
    
    return {
      researchData: result.text
    };
  }
};

// åŸ·ç­†ã‚¹ãƒ†ãƒƒãƒ—
const writingStep: Step = {
  id: 'writing',
  action: async ({ researchData, topic }) => {
    const agent = new Agent({
      name: 'Writer',
      instructions: 'æŠ€è¡“è¨˜äº‹ã‚’ä½œæˆã™ã‚‹å°‚é–€å®¶ã¨ã—ã¦ã€èª­ã¿ã‚„ã™ãå®Ÿè·µçš„ãªè¨˜äº‹ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚',
      model: openai('gpt-4o-mini'),
    });
    
    const result = await agent.text(`
    ä»¥ä¸‹ã®èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ã€ã€Œ${topic}ã€ã«ã¤ã„ã¦ã®æŠ€è¡“è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š
    
    èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ï¼š
    ${researchData}
    
    è¨˜äº‹ã®è¦ä»¶ï¼š
    - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼
    - ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’å«ã‚ã‚‹
    - åˆå¿ƒè€…ã«ã‚‚ã‚ã‹ã‚Šã‚„ã™ã„èª¬æ˜
    - å®Ÿè·µçš„ãªå†…å®¹
    `);
    
    return {
      article: result.text
    };
  }
};

// ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—
const reviewStep: Step = {
  id: 'review',
  action: async ({ article }) => {
    const agent = new Agent({
      name: 'Reviewer',
      instructions: 'è¨˜äº‹ã®å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã—ã€æ”¹å–„ææ¡ˆã‚’è¡Œã†å°‚é–€å®¶ã§ã™ã€‚',
      model: openai('gpt-4o-mini'),
    });
    
    const result = await agent.text(`
    ä»¥ä¸‹ã®è¨˜äº‹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€æ”¹å–„ææ¡ˆã‚’è¡Œã£ã¦ãã ã•ã„ï¼š
    
    ${article}
    
    ãƒã‚§ãƒƒã‚¯é …ç›®ï¼š
    - å†…å®¹ã®æ­£ç¢ºæ€§
    - æ§‹æˆã®ã‚ã‹ã‚Šã‚„ã™ã•
    - ã‚³ãƒ¼ãƒ‰ä¾‹ã®å“è³ª
    - æ”¹å–„ææ¡ˆ
    `);
    
    return {
      reviewResult: result.text,
      finalArticle: article
    };
  }
};

// ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®šç¾©
export const contentCreationWorkflow = new Workflow({
  name: 'Content Creation Workflow',
  steps: [researchStep, writingStep, reviewStep]
});

// ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œ
export async function createArticle(topic: string) {
  const result = await contentCreationWorkflow.execute({
    topic
  });
  
  return result;
}
```

### 2. æ¡ä»¶åˆ†å²ä»˜ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

æ¡ä»¶ã«å¿œã˜ã¦å‡¦ç†ã‚’åˆ†å²ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```typescript:src/workflows/conditional-workflow.ts
import { Workflow, Step } from '@mastra/core';
import { openai } from '@mastra/provider-openai';

// ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ†æã‚¹ãƒ†ãƒƒãƒ—
const analysisStep: Step = {
  id: 'analysis',
  action: async ({ content }) => {
    const agent = new Agent({
      name: 'ContentAnalyzer',
      instructions: 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç¨®é¡ã¨å“è³ªã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚',
      model: openai('gpt-4o-mini'),
    });
    
    const result = await agent.text(`
    ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åˆ†æã—ã€JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
    
    ${content}
    
    åˆ†æé …ç›®ï¼š
    {
      "type": "è¨˜äº‹ã®ã‚¿ã‚¤ãƒ—ï¼ˆtutorial, reference, etc.ï¼‰",
      "quality": "å“è³ªã‚¹ã‚³ã‚¢ï¼ˆ1-10ï¼‰",
      "needsImprovement": true/false,
      "topics": ["é–¢é€£ãƒˆãƒ”ãƒƒã‚¯1", "é–¢é€£ãƒˆãƒ”ãƒƒã‚¯2"]
    }
    `);
    
    try {
      const analysis = JSON.parse(result.text);
      return analysis;
    } catch {
      return {
        type: 'unknown',
        quality: 5,
        needsImprovement: true,
        topics: []
      };
    }
  }
};

// æ”¹å–„ã‚¹ãƒ†ãƒƒãƒ—
const improvementStep: Step = {
  id: 'improvement',
  condition: ({ analysis }) => analysis.needsImprovement,
  action: async ({ content, analysis }) => {
    const agent = new Agent({
      name: 'ContentImprover',
      instructions: 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ”¹å–„ã—ã€ã‚ˆã‚Šè‰¯ã„å“è³ªã«ã—ã¦ãã ã•ã„ã€‚',
      model: openai('gpt-4o-mini'),
    });
    
    const result = await agent.text(`
    ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ”¹å–„ã—ã¦ãã ã•ã„ï¼š
    
    ç¾åœ¨ã®å†…å®¹ï¼š
    ${content}
    
    åˆ†æçµæœï¼š
    å“è³ªã‚¹ã‚³ã‚¢: ${analysis.quality}/10
    ã‚¿ã‚¤ãƒ—: ${analysis.type}
    
    æ”¹å–„ã—ã¦ã»ã—ã„ç‚¹ï¼š
    - ã‚ˆã‚Šå…·ä½“çš„ãªä¾‹ã®è¿½åŠ 
    - ã‚³ãƒ¼ãƒ‰ã‚µãƒ³ãƒ—ãƒ«ã®æ”¹è‰¯
    - æ§‹æˆã®æœ€é©åŒ–
    `);
    
    return {
      improvedContent: result.text
    };
  }
};

// æœ€çµ‚åŒ–ã‚¹ãƒ†ãƒƒãƒ—
const finalizationStep: Step = {
  id: 'finalization',
  action: async ({ content, improvedContent }) => {
    const finalContent = improvedContent || content;
    
    return {
      finalContent,
      processedAt: new Date().toISOString()
    };
  }
};

export const contentProcessingWorkflow = new Workflow({
  name: 'Content Processing Workflow',
  steps: [analysisStep, improvementStep, finalizationStep]
});
```

## RAGï¼ˆæ¤œç´¢æ‹¡å¼µç”Ÿæˆï¼‰ã®å®Ÿè£…

### 1. ãƒ™ã‚¯ãƒˆãƒ«ã‚¹ãƒˆã‚¢ã®è¨­å®š

```typescript:src/rag/knowledge-base.ts
import { Agent, VectorStore } from '@mastra/core';
import { openai } from '@mastra/provider-openai';

// ãƒ™ã‚¯ãƒˆãƒ«ã‚¹ãƒˆã‚¢ã®åˆæœŸåŒ–
const vectorStore = new VectorStore({
  name: 'tech-docs',
  provider: 'pinecone', // ã¾ãŸã¯ 'qdrant', 'chromadb'
  config: {
    apiKey: process.env.PINECONE_API_KEY,
    environment: process.env.PINECONE_ENVIRONMENT,
    indexName: 'tech-knowledge-base'
  }
});

// RAGå¯¾å¿œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
const ragAgent = new Agent({
  name: 'KnowledgeAssistant',
  instructions: `
    ã‚ãªãŸã¯æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å°‚é–€å®¶ã§ã™ã€‚
    æä¾›ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åŸºã«ã€æ­£ç¢ºã§è©³ç´°ãªå›ç­”ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
  `,
  model: openai('gpt-4o-mini'),
  memory: new Memory({ name: 'rag-memory' }),
});

// ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¿½åŠ 
export async function addDocuments(documents: Array<{
  content: string;
  metadata: Record<string, any>;
}>) {
  for (const doc of documents) {
    await vectorStore.add({
      content: doc.content,
      metadata: doc.metadata
    });
  }
  
  console.log(`${documents.length}ä»¶ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
}

// çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã£ãŸè³ªå•å¿œç­”
export async function askWithKnowledge(question: string) {
  // é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ¤œç´¢
  const relevantDocs = await vectorStore.similaritySearch(question, {
    limit: 5,
    threshold: 0.7
  });
  
  // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æ§‹ç¯‰
  const context = relevantDocs
    .map(doc => `[${doc.metadata.title}]\n${doc.content}`)
    .join('\n\n---\n\n');
  
  // RAGã‚’ä½¿ã£ãŸå›ç­”ç”Ÿæˆ
  const response = await ragAgent.text(`
    ä»¥ä¸‹ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‚è€ƒã«è³ªå•ã«ç­”ãˆã¦ãã ã•ã„ï¼š
    
    ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼š
    ${context}
    
    è³ªå•ï¼š
    ${question}
    
    å›ç­”ã®è¦ä»¶ï¼š
    - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æƒ…å ±ã‚’æ´»ç”¨ã™ã‚‹
    - ä¸è¶³ã—ã¦ã„ã‚‹æƒ…å ±ãŒã‚ã‚Œã°è¨€åŠã™ã‚‹
    - å…·ä½“çš„ã§å®Ÿè·µçš„ãªå†…å®¹ã«ã™ã‚‹
  `);
  
  return {
    answer: response.text,
    sources: relevantDocs.map(doc => doc.metadata),
    confidence: relevantDocs.length > 0 ? 'high' : 'low'
  };
}

// ä½¿ç”¨ä¾‹ï¼šæŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¿½åŠ 
export async function initializeKnowledgeBase() {
  const docs = [
    {
      content: `
      TypeScriptã¯ã€Microsoftã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã€
      JavaScriptã«é™çš„å‹ä»˜ã‘ã‚’è¿½åŠ ã—ãŸã‚‚ã®ã§ã™ã€‚
      å¤§è¦æ¨¡ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã«ãŠã„ã¦ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã¨ä¿å®ˆæ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚
      `,
      metadata: {
        title: 'TypeScriptæ¦‚è¦',
        category: 'language',
        difficulty: 'beginner'
      }
    },
    {
      content: `
      Reactã¯ã€Facebookã«ã‚ˆã£ã¦é–‹ç™ºã•ã‚ŒãŸJavaScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã€
      ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æ§‹ç¯‰ã«ç‰¹åŒ–ã—ã¦ã„ã¾ã™ã€‚
      ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒç‰¹å¾´ã§ã™ã€‚
      `,
      metadata: {
        title: 'ReactåŸºç¤',
        category: 'framework',
        difficulty: 'beginner'
      }
    }
  ];
  
  await addDocuments(docs);
}
```

## å®Ÿç”¨çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¾‹

### 1. æŠ€è¡“ãƒ–ãƒ­ã‚°è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

```typescript:src/applications/blog-generator.ts
import { Agent, Workflow, Step } from '@mastra/core';
import { openai } from '@mastra/provider-openai';
import { fileOperationTool } from '../tools/file-tool';

class BlogGenerator {
  private researchAgent: Agent;
  private writerAgent: Agent;
  private editorAgent: Agent;
  
  constructor() {
    this.researchAgent = new Agent({
      name: 'ResearchAgent',
      instructions: 'ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦å¾¹åº•çš„ãªèª¿æŸ»ã‚’è¡Œã„ã€æœ€æ–°ã®æƒ…å ±ã‚’ã¾ã¨ã‚ã‚‹å°‚é–€å®¶',
      model: openai('gpt-4o-mini'),
      tools: [apiRequestTool]
    });
    
    this.writerAgent = new Agent({
      name: 'WriterAgent',
      instructions: 'æŠ€è¡“è¨˜äº‹ã‚’é­…åŠ›çš„ã§èª­ã¿ã‚„ã™ã„å½¢ã§åŸ·ç­†ã™ã‚‹å°‚é–€å®¶',
      model: openai('gpt-4o-mini'),
      tools: [fileOperationTool]
    });
    
    this.editorAgent = new Agent({
      name: 'EditorAgent',
      instructions: 'è¨˜äº‹ã®å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã—ã€SEOæœ€é©åŒ–ã‚‚è¡Œã†ç·¨é›†è€…',
      model: openai('gpt-4o-mini'),
    });
  }
  
  async generateBlogPost(topic: string, targetAudience: string = 'ä¸­ç´šé–‹ç™ºè€…') {
    console.log(`ãƒ–ãƒ­ã‚°è¨˜äº‹ã®ç”Ÿæˆã‚’é–‹å§‹: ${topic}`);
    
    // 1. ãƒªã‚µãƒ¼ãƒãƒ•ã‚§ãƒ¼ã‚º
    const research = await this.researchAgent.text(`
      ã€Œ${topic}ã€ã«ã¤ã„ã¦ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰èª¿æŸ»ã—ã¦ãã ã•ã„ï¼š
      1. æœ€æ–°ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã¨å‹•å‘
      2. å®Ÿç”¨çš„ãªä½¿ç”¨ä¾‹
      3. ã‚ˆãã‚ã‚‹èª²é¡Œã¨è§£æ±ºç­–
      4. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
      
      å¯¾è±¡èª­è€…: ${targetAudience}
    `);
    
    // 2. åŸ·ç­†ãƒ•ã‚§ãƒ¼ã‚º
    const article = await this.writerAgent.text(`
      ä»¥ä¸‹ã®èª¿æŸ»çµæœã‚’åŸºã«ã€é­…åŠ›çš„ãªæŠ€è¡“è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š
      
      èª¿æŸ»çµæœï¼š
      ${research.text}
      
      è¨˜äº‹ã®è¦ä»¶ï¼š
      - ã‚¿ã‚¤ãƒˆãƒ«ã¯èˆˆå‘³ã‚’å¼•ãã‚‚ã®ã«
      - å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’å«ã‚ã‚‹
      - æ®µéšçš„ãªèª¬æ˜ã‚’å¿ƒãŒã‘ã‚‹
      - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§å‡ºåŠ›
      - èª­è€…ãŒå®Ÿéš›ã«è©¦ã›ã‚‹å†…å®¹ã«ã™ã‚‹
      
      å¯¾è±¡èª­è€…: ${targetAudience}
    `);
    
    // 3. ç·¨é›†ãƒ»æœ€é©åŒ–ãƒ•ã‚§ãƒ¼ã‚º
    const finalArticle = await this.editorAgent.text(`
      ä»¥ä¸‹ã®è¨˜äº‹ã‚’ç·¨é›†ã—ã€å“è³ªå‘ä¸Šã¨SEOæœ€é©åŒ–ã‚’è¡Œã£ã¦ãã ã•ã„ï¼š
      
      ${article.text}
      
      ç·¨é›†è¦ä»¶ï¼š
      - æ–‡ç« ã®æµã‚Œã¨èª­ã¿ã‚„ã™ã•ã®æ”¹å–„
      - é©åˆ‡ãªè¦‹å‡ºã—æ§‹é€ ã®ç¢ºä¿
      - SEOã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®è‡ªç„¶ãªé…ç½®
      - ã‚³ãƒ¼ãƒ‰ã‚µãƒ³ãƒ—ãƒ«ã®å“è³ªãƒã‚§ãƒƒã‚¯
      - æœ€çµ‚çš„ãªå“è³ªç¢ºä¿
    `);
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
    const fileName = `${topic.replace(/[^a-zA-Z0-9]/g, '-')}-${Date.now()}.md`;
    await this.writerAgent.text(`
      ä»¥ä¸‹ã®è¨˜äº‹å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ« 'output/${fileName}' ã«ä¿å­˜ã—ã¦ãã ã•ã„ï¼š
      
      ${finalArticle.text}
    `);
    
    return {
      article: finalArticle.text,
      fileName,
      generatedAt: new Date().toISOString()
    };
  }
}

// ä½¿ç”¨ä¾‹
export async function generateTechBlog() {
  const generator = new BlogGenerator();
  
  const result = await generator.generateBlogPost(
    'Mastra ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ãŸAIé–‹ç™º',
    'TypeScripté–‹ç™ºè€…'
  );
  
  console.log('è¨˜äº‹ç”Ÿæˆå®Œäº†:', result.fileName);
  return result;
}
```

### 2. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ

```typescript:src/applications/code-reviewer.ts
import { Agent } from '@mastra/core';
import { openai } from '@mastra/provider-openai';

class CodeReviewAssistant {
  private reviewerAgent: Agent;
  
  constructor() {
    this.reviewerAgent = new Agent({
      name: 'CodeReviewer',
      instructions: `
        ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªã‚·ãƒ‹ã‚¢é–‹ç™ºè€…ã¨ã—ã¦ã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã„ã¾ã™ã€‚
        ä»¥ä¸‹ã®è¦³ç‚¹ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ï¼š
        1. ã‚³ãƒ¼ãƒ‰å“è³ªï¼ˆå¯èª­æ€§ã€ä¿å®ˆæ€§ï¼‰
        2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
        3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
        4. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®éµå®ˆ
        5. æ½œåœ¨çš„ãªãƒã‚°
        
        å»ºè¨­çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¨å…·ä½“çš„ãªæ”¹å–„ææ¡ˆã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
      `,
      model: openai('gpt-4o-mini'),
    });
  }
  
  async reviewCode(code: string, language: string = 'typescript') {
    const review = await this.reviewerAgent.text(`
      ä»¥ä¸‹ã®${language}ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ï¼š
      
      \`\`\`${language}
      ${code}
      \`\`\`
      
      ãƒ¬ãƒ“ãƒ¥ãƒ¼å½¢å¼ï¼š
      ## å…¨ä½“çš„ãªè©•ä¾¡
      - è©•ä¾¡ã‚¹ã‚³ã‚¢: [1-10]
      - ä¸»ãªå•é¡Œç‚¹
      
      ## è©³ç´°ãªæŒ‡æ‘˜
      ### è‰¯ã„ç‚¹
      - [å…·ä½“çš„ãªè‰¯ã„ç‚¹]
      
      ### æ”¹å–„ç‚¹
      - [å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ]
      
      ### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
      - [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã®æŒ‡æ‘˜]
      
      ## æ”¹å–„ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ä¾‹
      \`\`\`${language}
      [æ”¹å–„ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰]
      \`\`\`
    `);
    
    return review.text;
  }
  
  async reviewPullRequest(diffContent: string) {
    const review = await this.reviewerAgent.text(`
      ä»¥ä¸‹ã®Gitãƒ‡ã‚£ãƒ•ã‚’ç²¾æŸ»ã—ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã£ã¦ãã ã•ã„ï¼š
      
      ${diffContent}
      
      ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ï¼š
      1. å¤‰æ›´å†…å®¹ã®å¦¥å½“æ€§
      2. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿
      3. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
      4. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ãŒå¿…è¦ã‹
      5. ç ´å£Šçš„å¤‰æ›´ã®æœ‰ç„¡
      
      GitHubå½¢å¼ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã§å›ç­”ã—ã¦ãã ã•ã„ã€‚
    `);
    
    return review.text;
  }
}

export async function performCodeReview() {
  const reviewer = new CodeReviewAssistant();
  
  const sampleCode = `
  function fetchUserData(userId: string) {
    const user = fetch('/api/users/' + userId)
      .then(response => response.json())
      .then(data => {
        return data;
      })
      .catch(error => {
        console.log(error);
      });
    return user;
  }
  `;
  
  const review = await reviewer.reviewCode(sampleCode);
  console.log('ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ:', review);
  
  return review;
}
```

## æœ¬ç•ªç’°å¢ƒã§ã®é‹ç”¨

### 1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ç›£è¦–

```typescript:src/monitoring/error-handling.ts
import { Agent } from '@mastra/core';
import { openai } from '@mastra/provider-openai';

class ResilientAgent {
  private agent: Agent;
  private retryCount: number = 0;
  private maxRetries: number = 3;
  
  constructor(config: any) {
    this.agent = new Agent(config);
  }
  
  async executeWithRetry(prompt: string, options?: any): Promise<string> {
    for (let attempt = 1; attempt <= this.maxRetries; attempt++) {
      try {
        const result = await this.agent.text(prompt, options);
        this.retryCount = 0; // æˆåŠŸæ™‚ã¯ãƒªã‚»ãƒƒãƒˆ
        return result.text;
        
      } catch (error) {
        console.error(`è©¦è¡Œ ${attempt} å¤±æ•—:`, error);
        
        if (attempt === this.maxRetries) {
          throw new Error(`${this.maxRetries}å›ã®è©¦è¡Œå¾Œã‚‚å¤±æ•—: ${error}`);
        }
        
        // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
        const delay = Math.pow(2, attempt - 1) * 1000;
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
    
    throw new Error('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼');
  }
  
  async healthCheck(): Promise<boolean> {
    try {
      await this.agent.text('Hello, test message');
      return true;
    } catch {
      return false;
    }
  }
}

// ä½¿ç”¨ä¾‹
export async function createResilientAgent() {
  const resilientAgent = new ResilientAgent({
    name: 'ProductionAgent',
    instructions: 'æœ¬ç•ªç’°å¢ƒã§å®‰å®šå‹•ä½œã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ',
    model: openai('gpt-4o-mini'),
  });
  
  // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  const isHealthy = await resilientAgent.healthCheck();
  console.log('ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹:', isHealthy ? 'æ­£å¸¸' : 'ç•°å¸¸');
  
  if (isHealthy) {
    const result = await resilientAgent.executeWithRetry(
      'ç°¡å˜ãªãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¿”ç­”ã—ã¦ãã ã•ã„'
    );
    console.log('ãƒ†ã‚¹ãƒˆçµæœ:', result);
  }
  
  return resilientAgent;
}
```

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```typescript:src/optimization/performance.ts
import { Agent, Cache } from '@mastra/core';
import { openai } from '@mastra/provider-openai';

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
const cache = new Cache({
  type: 'redis',
  url: process.env.REDIS_URL,
  ttl: 3600 // 1æ™‚é–“
});

class OptimizedAgent {
  private agent: Agent;
  private cache: Cache;
  
  constructor() {
    this.agent = new Agent({
      name: 'OptimizedAgent',
      instructions: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã•ã‚ŒãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ',
      model: openai('gpt-4o-mini'),
    });
    
    this.cache = cache;
  }
  
  async executeWithCache(prompt: string, cacheKey?: string): Promise<string> {
    const key = cacheKey || this.generateCacheKey(prompt);
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ã‚’è©¦è¡Œ
    const cached = await this.cache.get(key);
    if (cached) {
      console.log('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰çµæœã‚’è¿”å´');
      return cached;
    }
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ãªã„å ´åˆã¯å®Ÿè¡Œ
    const result = await this.agent.text(prompt);
    
    // çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
    await this.cache.set(key, result.text);
    
    return result.text;
  }
  
  private generateCacheKey(prompt: string): string {
    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
    const crypto = require('crypto');
    return crypto.createHash('md5').update(prompt).digest('hex');
  }
  
  async batchProcess(prompts: string[]): Promise<string[]> {
    // ä¸¦åˆ—å‡¦ç†ã§è¤‡æ•°ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’åŠ¹ç‡çš„ã«å‡¦ç†
    const promises = prompts.map(prompt => 
      this.executeWithCache(prompt)
    );
    
    return Promise.all(promises);
  }
}

export async function demonstrateOptimization() {
  const optimizedAgent = new OptimizedAgent();
  
  // è¤‡æ•°ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸¦åˆ—å‡¦ç†
  const prompts = [
    'TypeScriptã®åˆ©ç‚¹ã‚’3ã¤æ•™ãˆã¦',
    'Reactã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ã¾ã¨ã‚ã¦',
    'Node.jsã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ–¹æ³•'
  ];
  
  console.time('ãƒãƒƒãƒå‡¦ç†æ™‚é–“');
  const results = await optimizedAgent.batchProcess(prompts);
  console.timeEnd('ãƒãƒƒãƒå‡¦ç†æ™‚é–“');
  
  console.log('å‡¦ç†çµæœ:', results.length, 'ä»¶');
  
  return results;
}
```

## ã¾ã¨ã‚

æœ¬è¨˜äº‹ã§ã¯ã€**Mastraãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’çµ„ã¿è¾¼ã‚€æ–¹æ³•**ã‚’åŒ…æ‹¬çš„ã«è§£èª¬ã—ã¾ã—ãŸã€‚

**ğŸ¯ Mastraã®ä¸»è¦ãªåˆ©ç‚¹**

>* **TypeScriptãƒã‚¤ãƒ†ã‚£ãƒ–**: å‹å®‰å…¨æ€§ã¨é–‹ç™ºä½“é¨“ã®å‘ä¸Š
>* **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œ**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ç›£è¦–æ©Ÿèƒ½ãŒå……å®Ÿ
>* **æŸ”è»Ÿãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€RAGã®çµ„ã¿åˆã‚ã›
>* **è±Šå¯Œãªçµ±åˆ**: å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æºãŒå®¹æ˜“

**ğŸ’¡ å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ**

>* **æ®µéšçš„å°å…¥**: åŸºæœ¬çš„ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰å§‹ã‚ã¦æ©Ÿèƒ½ã‚’æ‹¡å¼µ
>* **ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«**: æ¥­å‹™ã«ç‰¹åŒ–ã—ãŸãƒ„ãƒ¼ãƒ«ã§å·®åˆ¥åŒ–
>* **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ´»ç”¨**: è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•åŒ–
>* **RAGçµ±åˆ**: å°‚é–€çŸ¥è­˜ã‚’æ´»ç”¨ã—ãŸé«˜ç²¾åº¦ãªå›ç­”

**âš¡ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**

>* **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã¸ã®å±•é–‹**: ç›£è¦–ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
>* **ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—**: è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å”èª¿ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
>* **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**: çµ„ç¹”å›ºæœ‰ã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ãŸæœ€é©åŒ–

Mastraã¯ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–‹ç™ºã®è¤‡é›‘ã•ã‚’æŠ½è±¡åŒ–ã—ãªãŒã‚‰ã€å®Ÿç”¨çš„ã§æ‹¡å¼µæ€§ã®é«˜ã„ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚ãœã²ã‚ãªãŸã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚æ´»ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ï¼